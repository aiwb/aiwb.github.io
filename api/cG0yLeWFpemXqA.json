{"title":"pm2 入门","date":"2016-03-26T07:09:48.000Z","author":"Wenbin","link":"pm2-入门","comments":true,"categories":["其他"],"updated":"2020-04-15T21:36:20.855Z","content":"<p>PM2 是一个自带负载均衡的 Node.js 应用的进程管理器。被普遍用户生产环境。</p>\n<p>(美团网甚至在其上开发了增强版的 PM2.5，有兴趣的同学可以自行研究。)</p>\n<h3 id=\"安装\">安装<a href=\"pm2-入门#安装\"></a></h3><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -g pm2</span><br></pre></td></tr></table></div></figure>\n\n<h3 id=\"常用命令\">常用命令<a href=\"pm2-入门#常用命令\"></a></h3><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 start app.js [-i 4]       # -i指定进程数，也可传递'-i max'</span><br><span class=\"line\">pm2 start app.js --name app   # 命名启动进程</span><br><span class=\"line\">pm2 list                      # 显示所有进程状态</span><br><span class=\"line\">pm2 monit                     # 监视所有进程的资源使用状况</span><br><span class=\"line\">pm2 logs                      # 显示所有进程日志</span><br><span class=\"line\">pm2 stop [all | name | id]    # 停止全部或者指定name或id的进程</span><br><span class=\"line\">pm2 restart [all | name | id] # 重启全部或者指定name或id的进程</span><br><span class=\"line\">pm2 reload [all | name |id]   # 0秒停机重载进程</span><br><span class=\"line\">pm2 delete [all | name |id]   # 删除全部或者指定name或id的进程</span><br></pre></td></tr></table></div></figure>\n\n\n<h3 id=\"日志管理\">日志管理<a href=\"pm2-入门#日志管理\"></a></h3><p>pm2会接管项目日志默认存放于用户目录下: <strong>~/.pm2/logs/</strong></p>\n<p>日志文件明构成：</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">错误日志：&#123;appName&#125;-error-&#123;id&#125;.log</span><br><span class=\"line\">其他日志：&#123;appName&#125;-out-&#123;id&#125;.log</span><br></pre></td></tr></table></div></figure>\n<p>注意：使用 pm2 logs 可实时查看所有进程日志。</p>\n<h4 id=\"日志切分\">日志切分<a href=\"pm2-入门#日志切分\"></a></h4><p>应用的日志应该由调度程序来控制，而不应该让应用自己来控制日志的切割存储等事情。<br>这样可以降低程序的复杂度，让程序专注于本身的业务逻辑。</p>\n<p>pm2 为我们提供了一个 <a href=\"https://github.com/pm2-hive/pm2-logrotate\" target=\"_blank\" rel=\"noopener\">pm2-logrotate</a> 插件来实现这些功能</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 install pm2-logrotate</span><br><span class=\"line\">pm2 set pm2-logrotate:interval 1          # 默认为1，可以不设置</span><br><span class=\"line\">pm2 set pm2-logrotate:interval_unit 'DD'  # 设置分文件的时间单位(默认天)，DD：天；MM：月；mm：分</span><br><span class=\"line\">pm2 set pm2-logrotate:max_size 100M       # 设置分文件的大小单位(默认10MB)，接受G,M,K</span><br><span class=\"line\">pm2 set pm2-logrotate:retain all          # 设置保存的日志数，超过将自动删除，接受 all | number</span><br></pre></td></tr></table></div></figure>\n\n<h3 id=\"reference\">reference<a href=\"pm2-入门#reference\"></a></h3><ul>\n<li><a href=\"http://tech.meituan.com/node-fullstack-development-practice.html\" target=\"_blank\" rel=\"noopener\">美团酒店Node全栈开发实践</a></li>\n</ul>\n","prev":{"title":"contos 安装 python 3.3","link":"contos-安装-python-3-3"},"next":{"title":"三人成团活动踩了个坑记录","link":"三人成团活动踩了个坑记录"},"plink":"https://wuwb.github.io/pm2-入门/","reward":true,"copyright":{"author":"Wenbin","link":"<a href=\"https://wuwb.github.io/pm2-入门/\" title=\"pm2 入门\">https://wuwb.github.io/pm2-入门/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-nd/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)"}}