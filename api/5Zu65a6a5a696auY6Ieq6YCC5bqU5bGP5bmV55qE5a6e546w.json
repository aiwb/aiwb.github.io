{"title":"固定宽高自适应屏幕的实现","date":"2015-06-02T16:25:09.000Z","link":"固定宽高自适应屏幕的实现","comments":true,"tags":["css"],"categories":["代码"],"updated":"2020-04-15T21:36:20.851Z","content":"<p>大家都知道wap开发中body宽度是按手机浏览器的虚拟像素宽度来适配的。而高度属性不像宽度一样可以直接取百分比来实现的。</p>\n<p>这里我就举一个等比宽高（10:4.5）会场banner的例子,下面是文件列表</p>\n<p>Js css：<br>public/jsmobile/src/page-tuan-brandsale.js<br>public/cssmobile/src/page-tuan-brandsale.css<br>Demo忽视吧：<br>appbeta/views/tuan/mact/mobile/demo_brandsale.php<br>（这里不推荐直接用内容图去撑，站内的图片用的尺寸都比较大，加载起来较慢，用内容图去撑dom，会照成页面元素高度变化频繁，影响体验。） 先展示下banner图的基本样式</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*设置屏幕宽度94%，最大宽度为480px，防止banner图过大失真*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.active_pre_box</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">94%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">max-width</span>: <span class=\"number\">480px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">8px</span> auto;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#d9d9d9</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.active_pre_box</span> <span class=\"selector-class\">.link_img</span> &#123; <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>; <span class=\"attribute\">display</span>: block; <span class=\"attribute\">position</span>: relative; <span class=\"attribute\">overflow</span>: hidden; &#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>psd上的标准效果</p>\n<p>alt text</p>\n<p>1 设置一个多层min-height</p>\n<p>因为宽度是按百分比随手机浏览器宽度变化的，所以我们要按市面上主流的宽度来分层做min-height高度适配：</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*针对360px以下的屏幕做适配*/</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> (max-width: <span class=\"number\">360px</span>)  &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.active_pre_box</span> <span class=\"selector-class\">.link_img</span> &#123; <span class=\"attribute\">min-height</span>: <span class=\"number\">135px</span>; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*针对[360px,420px)的屏幕做适配*/</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> (min-width: <span class=\"number\">360px</span>) and (max-width: <span class=\"number\">420px</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/*不同屏幕设置不同min-height*/</span></span><br><span class=\"line\">    <span class=\"selector-class\">.active_pre_box</span> <span class=\"selector-class\">.link_img</span> &#123; <span class=\"attribute\">min-height</span>: <span class=\"number\">152px</span>; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*针对[420px,480px)的屏幕做适配*/</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> (min-width: <span class=\"number\">420px</span>) and (max-width: <span class=\"number\">480px</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/*不同屏幕设置不同min-height*/</span></span><br><span class=\"line\">    <span class=\"selector-class\">.active_pre_box</span> <span class=\"selector-class\">.link_img</span> &#123; <span class=\"attribute\">min-height</span>: <span class=\"number\">178px</span>; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*适配480px以上屏幕*/</span></span><br><span class=\"line\">@<span class=\"keyword\">media</span> (min-width: <span class=\"number\">480px</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/*不同屏幕设置不同min-height*/</span></span><br><span class=\"line\">    <span class=\"selector-class\">.active_pre_box</span> <span class=\"selector-class\">.link_img</span> &#123; <span class=\"attribute\">min-height</span>: <span class=\"number\">216px</span>; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>这样做好后在320px，360px，420px，480px这几个标准尺寸的浏览器宽度下宽高比都为标准的10:4.5。</p>\n<p>但是在这几个标准尺寸之间的值就会比例就会稍有失调，例如479px下的显示效果</p>\n<p>alt text</p>\n<p>因为比列失调图片被截取了明显不能忍啊</p>\n<p>2设置撑高占位图撑高</p>\n<p>原理就是截取宽高比一张小的单色图来设置width:100%来实现等高占位。</p>\n<p>html代码：</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 活动预览 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"active_pre_box\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"link_img\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript:;\"</span> <span class=\"attr\">target</span>=<span class=\"string\">\"_blank\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 撑高占位图 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fill_img\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://s8.mogujie.cn/pic/140630/o61vu_kq2c42kkkrbdissugfjeg5sckzsew_20x9.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- banner图片 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">class</span>=<span class=\"string\">\"banner_img lazy\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://dummyimage.com/480x216/2ea79d/fff\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 信息栏 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"active_info_bar\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fr active_discount\"</span>&gt;</span>0.3折起<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fl active_name\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"javascript:;\"</span> <span class=\"attr\">target</span>=<span class=\"string\">\"_blank\"</span>&gt;</span>SIX GOD--蓝胖最爱！<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">css代码</span><br><span class=\"line\"></span><br><span class=\"line\">.fill_img &#123; display: block; width: 100%; &#125;</span><br><span class=\"line\">/*内容图设置position:absolute,来定位*/</span><br><span class=\"line\">.active_pre_box .banner_img &#123;</span><br><span class=\"line\">    display: block;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    top: 0; left: 0;</span><br><span class=\"line\">    width: 100%;</span><br><span class=\"line\">    border-radius: 5px 5px 0 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>这样就算banner内容图加载比较慢，dom也可以撑起来，还可以有一个稍微好看的背景，体验提升啊。 alt text</p>\n<p>但是！这样就有连带出2个问题了：</p>\n<p>1）怎么保证占位图预先出现</p>\n<p>2）怎么保证占位图加载成功</p>\n<p>解决1很简单在代码最上部设置一个预加载的dom，先把占位img放进去就好了</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.img_pre_hid &#123; height: 0; overflow: hidden; &#125;</span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 占位图片预加载 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"img_pre_hid\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://s6.mogujie.cn/pic/140624/2_kq2g4tkdkrbegqkugfjeg5sckzsew_2x1.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://s6.mogujie.cn/pic/140624/5_kq2ee3sdkrbgevsugfjeg5sckzsew_5x2.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://s6.mogujie.cn/pic/140625/2_kq2hutk7krbhgssugfjeg5sckzsew_2x2.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://s13.mogujie.cn/pic/140630/o61vu_kq2eiukkkrbdissugfjeg5sckzsew_20x11.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://s6.mogujie.cn/pic/140630/o61vu_kq2c42kkkrbdissugfjeg5sckzsew_20x9.png\"</span> <span class=\"attr\">alt</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<p>解决2 则利用img的onerror事件来做一个失败重加载</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 图片出错处理，可以重加载指定的图片。超过重试次数仍不能正常显示的，显示缺省图片。</span></span><br><span class=\"line\"><span class=\"comment\"> * imgObj:img节点对象</span></span><br><span class=\"line\"><span class=\"comment\"> * maxErrorNum:最大出错次数，防止出现死循环</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">imgErrorReload</span>(<span class=\"params\">imgObj,maxErrorNum</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgSrc = imgObj.src;</span><br><span class=\"line\">    <span class=\"comment\">// 每次加载失败次数减一</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(maxErrorNum&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        imgObj.onerror=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            imgErrorReload(imgObj,maxErrorNum<span class=\"number\">-1</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 延迟0.5秒重新加载</span></span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            imgObj.src=imgSrc;</span><br><span class=\"line\">        &#125;,<span class=\"number\">500</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 加载次数用完处理</span></span><br><span class=\"line\">        <span class=\"comment\">// imgObj.onerror=null;</span></span><br><span class=\"line\">        <span class=\"comment\">// imgObj.src=\"images/default.jpg\";</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 遍历占位图片，初始化onerror方法</span></span><br><span class=\"line\">$(<span class=\"string\">'.img_pre_hid img'</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"keyword\">this</span>.complete ) &#123;</span><br><span class=\"line\">        imgErrorReload(<span class=\"keyword\">this</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            imgErrorReload(<span class=\"keyword\">this</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></div></figure>\n","prev":{"title":"new Image() 打点注意事项","link":"new-Image-打点注意事项"},"next":{"title":"swipe组件使用注意事项","link":"swipe组件使用注意事项"},"plink":"https://wuwb.github.io/固定宽高自适应屏幕的实现/","reward":true,"copyright":{"author":"吴文斌","link":"<a href=\"https://wuwb.github.io/固定宽高自适应屏幕的实现/\" title=\"固定宽高自适应屏幕的实现\">https://wuwb.github.io/固定宽高自适应屏幕的实现/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-nd/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)"}}