{"title":"用 docker compose 部署 odoo 12","date":"2019-10-21T13:55:44.000Z","link":"用-docker-compose-部署-odoo-12","comments":true,"tags":["odoo"],"updated":"2020-04-15T21:36:20.855Z","content":"<p>最近买了一个威联通 Nas, 试着在上面安装一个 CRM 系统给老婆的店铺用。官方给的例子比较简单，我这里做了一些扩充。</p>\n<p>威联通内置的 Container Station 不太好用，这里是通过 ssh 连上威联通，直接通过 docker-compose.yml 文件创建服务。本着简单的原则，威联通上 docker 无法下载镜像等问题，等我再开一篇文章介绍。</p>\n<p>先是一个合并两个服务的 docker compose 编排方式。</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight\"><figcaption><span>/share/Container/services/odoo/docker-compose.yml</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">version</span>: '3.1'</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">services:</span></span><br><span class=\"line\">  odoo:</span><br><span class=\"line\">    <span class=\"attribute\">image</span>: odoo:12.0</span><br><span class=\"line\">    <span class=\"attribute\">container_name</span>: odoo</span><br><span class=\"line\">    <span class=\"attribute\">depend_on</span>: postgres</span><br><span class=\"line\">    <span class=\"attribute\">ports:</span></span><br><span class=\"line\">      - \"8069:8069\"</span><br><span class=\"line\">    <span class=\"attribute\">networks:</span></span><br><span class=\"line\">      - odoo</span><br><span class=\"line\">    <span class=\"attribute\">environment:</span></span><br><span class=\"line\">      - HOST=postgres</span><br><span class=\"line\">      - PORT=5432</span><br><span class=\"line\">      - USER=odoo</span><br><span class=\"line\">      - PASSWORD=odoo</span><br><span class=\"line\">    <span class=\"attribute\">volumes:</span></span><br><span class=\"line\">      - /share/Container/data/odoo/data:/var/lib/odoo</span><br><span class=\"line\">      - /share/Container/data/odoo/config:/etc/odoo</span><br><span class=\"line\">      - /share/Container/data/odoo/addons:/mnt/extra-addons</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attribute\">postgres:</span></span><br><span class=\"line\">    image: postgres:10</span><br><span class=\"line\">    <span class=\"attribute\">container_name</span>: postgres</span><br><span class=\"line\">    <span class=\"attribute\">restart</span>: always</span><br><span class=\"line\">    <span class=\"attribute\">ports:</span></span><br><span class=\"line\">      - \"5432:5432\"</span><br><span class=\"line\">    <span class=\"attribute\">networks:</span></span><br><span class=\"line\">      - odoo</span><br><span class=\"line\">    <span class=\"attribute\">environment:</span></span><br><span class=\"line\">      - POSTGRES_DB=postgres</span><br><span class=\"line\">      - POSTGRES_PASSWORD=odoo</span><br><span class=\"line\">      - POSTGRES_USER=odoo</span><br><span class=\"line\">      - PGDATA=/var/lib/postgresql/data/pgdata</span><br><span class=\"line\">    <span class=\"attribute\">volumes:</span></span><br><span class=\"line\">      - /share/Container/data/postgres/data:/var/lib/postgresql/data/pgdata</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">networks:</span></span><br><span class=\"line\">    odoo:</span><br><span class=\"line\">        <span class=\"attribute\">external</span>: true</span><br></pre></td></tr></table></div></figure>\n\n<p>有些人可能想把 postgres 分出来，给其他服务共同使用。那要的话，可以把 postgres 拿出来单独放一个 docker-compose 配置中，然后 odoo 的 compose 文件中通过 link 将两个容器连接起来，连接起来后两个容器的 hosts 中会自动注入各自容器 ip 和 别名，比如：</p>\n<figure class=\"highlight\"><figcaption><span>/etc/hosts</span></figcaption><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">172.17</span><span class=\"number\">.2</span><span class=\"number\">.186</span>  postgres</span><br><span class=\"line\"><span class=\"number\">172.17</span><span class=\"number\">.2</span><span class=\"number\">.186</span>  odoo</span><br></pre></td></tr></table></div></figure>\n\n<p>同样的，odoo 的环境变量配置中设置 <code>HOST=postgres</code> 就可以。</p>\n<h3 id=\"参考\">参考<a href=\"用-docker-compose-部署-odoo-12#参考\"></a></h3><ul>\n<li><a href=\"https://hub.docker.com/_/odoo\" target=\"_blank\" rel=\"noopener\">https://hub.docker.com/_/odoo</a></li>\n<li><a href=\"https://hub.docker.com/_/postgres\" target=\"_blank\" rel=\"noopener\">https://hub.docker.com/_/postgres</a></li>\n</ul>\n","prev":{"title":"mac 安装 minikube 方法","link":"mac-安装-minikube-方法"},"next":{"title":"odoo 12 配置文件解析","link":"odoo-12-配置文件解析"},"plink":"https://wuwb.github.io/用-docker-compose-部署-odoo-12/","reward":true,"copyright":{"author":"吴文斌","link":"<a href=\"https://wuwb.github.io/用-docker-compose-部署-odoo-12/\" title=\"用 docker compose 部署 odoo 12\">https://wuwb.github.io/用-docker-compose-部署-odoo-12/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-nd/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)"}}